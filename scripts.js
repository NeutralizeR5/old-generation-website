const translations = {
  en: {
    title: "OLD GENERATION VESTIGIA OF VALOUR",
    header_subtitle: "PRESERVING LEGACY, COMMANDING DESTINY",
    nav_stats: "Intelligence", nav_profiles: "Legion", nav_terminology: "Archives", nav_contact: "Enlistment",
    stats_title: "Strategic Metrics", members_label: "Elite Combatants", might_label: "Collective Potency", level_label: "Sovereign Level",
    profiles_title: "High Council", member1_name: "Supreme Leader", member1_role: "R5 LEADER",
    member2_name: "War General", member2_role: "R4 WAR LEADER", member3_name: "Shield Master", member3_role: "R4 DEFENCE LEADER",
    terminology_title: "Tactical Compendium",
    calc_title: "Deployment Calculator", calc_label_total: "Total Deployment Size", calc_label_split: "Ratio Integration",
    calc_split_40: "40% T5 60% T4 (Standard Vanguard)", calc_split_50: "50% T5 50% T4 (Equilibrium)", calc_split_60: "60% T5 40% T4 (Heavy Assault)", calc_split_100: "100% T4 (Pure Vanguard)",
    calc_label_comp: "Formation Strategy", comp_inf: "Infantry Blast", comp_rng: "Ranged Blast", comp_cav: "Cavalry Blast",
    comp_442: "Mixed 4 4 2 (Inf Rng Focus)", comp_424: "Mixed 4 2 4 (Inf Cav Focus)", comp_244: "Mixed 2 4 4 (Rng Cav Focus)",
    btn_calculate: "Compute Matrix", calc_result_title: "Deployment Matrix Overview", res_inf_title: "Infantry", res_rng_title: "Ranged", res_cav_title: "Cavalry",
    btn_copy: "Copy to Clipboard", msg_copied: "Matrix Copied!",
    contact_title: "The Inquisitorial Protocol", label_name: "In Game Name", label_iggid: "Unique IGG ID", label_might: "Might Stature",
    label_role: "Specialisation", label_message: "Statement of Intent", form_disclaimer: "Submission is a formal pledge of loyalty.",
    prev_btn: "Back", next_btn: "Proceed", submit_btn: "Formalise Enlistment",
    footer1: "OLD GENERATION: Cultivating martial excellence since 2016.", copy_title: "SOVEREIGN PROTECTION", copy_message: "This property belongs to OLD GENERATION.",
    ph_name: "State your exact player alias", ph_iggid: "Numeric Identity", ph_might: "e.g. 2.5bn", ph_message: "Detail your purpose for joining our ranks..."
  },
  tr: {
    title: "OLD GENERATION ASLA PES ETME",
    header_subtitle: "MİRASI KORUYOR, KADERİ YENİYORUZ",
    nav_stats: "İstihbarat", nav_profiles: "Lejyon", nav_terminology: "Arşivler", nav_contact: "Başvuru",
    stats_title: "Stratejik Veriler", members_label: "Seçkin Savaşçılar", might_label: "Toplam Kudret", level_label: "Lonca Kademesi",
    profiles_title: "Yüksek Konsey", member1_name: "Yüce Lider", member1_role: "R5 LİDER",
    member2_name: "Savaş Generali", member2_role: "R4 SAVAŞ LİDERİ", member3_name: "Kalkan Ustası", member3_role: "R4 SAVUNMA LİDERİ",
    terminology_title: "Taktik Rehber",
    calc_title: "Birlik Dağılım Hesaplayıcısı", calc_label_total: "Toplam Birlik Kapasitesi", calc_label_split: "Oran Dağılımı",
    calc_split_40: "40% T5 60% T4 (Standart Öncü)", calc_split_50: "50% T5 50% T4 (Dengeli)", calc_split_60: "60% T5 40% T4 (Ağır Taarruz)", calc_split_100: "100% T4 (Saf Öncü)",
    calc_label_comp: "Formasyon Stratejisi", comp_inf: "Piyade (Blast)", comp_rng: "Menzilli (Blast)", comp_cav: "Süvari (Blast)",
    comp_442: "Karma 4 4 2 (Piy Men Ağırlıklı)", comp_424: "Karma 4 2 4 (Piy Süv Ağırlıklı)", comp_244: "Karma 2 4 4 (Men Süv Ağırlıklı)",
    btn_calculate: "Matrisi Hesapla", calc_result_title: "Dağılım Matrisi Özeti", res_inf_title: "Piyade", res_rng_title: "Menzilli", res_cav_title: "Süvari",
    btn_copy: "Panoya Kopyala", msg_copied: "Matris Kopyalandı!",
    contact_title: "Üyelik Sorgulama Protokolü", label_name: "Oyun İçi İsim", label_iggid: "Benzersiz IGG ID", label_might: "Kudret Seviyesi",
    label_role: "Uzmanlık Alanı", label_message: "Niyet Beyanı", form_disclaimer: "Gönderim resmi bir sadakat yemini teşkil eder.",
    prev_btn: "Geri", next_btn: "Devam Et", submit_btn: "Kaydı Resmileştir",
    footer1: "OLD GENERATION: 2016'dan beri askeri mükemmellik inşa ediyoruz.", copy_title: "İÇERİK KORUMASI", copy_message: "Bu mülkiyet OLD GENERATION'a aittir.",
    ph_name: "Askeri künyenizi beyan edin", ph_iggid: "Sayısal Kimliğiniz", ph_might: "Örn. 2.5mr", ph_message: "Saflarımıza katılma amacınızı detaylandırın..."
  },
  it: {
    title: "OLD GENERATION VESTIGIA DI VALORE",
    header_subtitle: "PRESERVARE L'EREDITÀ, COMANDARE IL DESTINO",
    nav_stats: "Intelligence", nav_profiles: "Legione", nav_terminology: "Archivi", nav_contact: "Arruolamento",
    stats_title: "Metriche Strategiche", members_label: "Combattenti d'Elite", might_label: "Potenza Collettiva", level_label: "Livello Sovrano",
    profiles_title: "Alto Consiglio", member1_name: "Capo Supremo", member1_role: "R5 LEADER",
    member2_name: "Generale di Guerra", member2_role: "R4 LEADER DI GUERRA", member3_name: "Maestro dello Scudo", member3_role: "R4 LEADER DELLA DIFESA",
    terminology_title: "Compendio Tattico",
    calc_title: "Calcolatore di Schieramento", calc_label_total: "Capacità Totale", calc_label_split: "Integrazione Rapporto",
    calc_split_40: "40% T5 60% T4 (Avanguardia Standard)", calc_split_50: "50% T5 50% T4 (Equilibrio)", calc_split_60: "60% T5 40% T4 (Assalto Pesante)", calc_split_100: "100% T4 (Pura Avanguardia)",
    calc_label_comp: "Strategia di Formazione", comp_inf: "Fanteria (Blast)", comp_rng: "Archi (Blast)", comp_cav: "Cavalleria (Blast)",
    comp_442: "Misto 4 4 2 (Focus Fan Arc)", comp_424: "Misto 4 2 4 (Focus Fan Cav)", comp_244: "Misto 2 4 4 (Focus Arc Cav)",
    btn_calculate: "Calcola Matrice", calc_result_title: "Panoramica Matrice", res_inf_title: "Fanteria", res_rng_title: "Archi", res_cav_title: "Cavalleria",
    btn_copy: "Copia negli Appunti", msg_copied: "Matrice Copiata!",
    contact_title: "Il Protocollo Inquisitorio", label_name: "Nome In Game", label_iggid: "ID IGG Univoco", label_might: "Potenza Attuale",
    label_role: "Specializzazione", label_message: "Dichiarazione d'Intenti", form_disclaimer: "L'invio costituisce un impegno di lealtà.",
    prev_btn: "Indietro", next_btn: "Procedi", submit_btn: "Formalizza l'Arruolamento",
    footer1: "OLD GENERATION: Coltiviamo l'eccellenza marziale dal 2016.", copy_title: "PROTEZIONE SOVRANA", copy_message: "Questa proprietà appartiene a OLD GENERATION.",
    ph_name: "Dichiara il tuo alias di battaglia", ph_iggid: "Identità Numerica", ph_might: "es. 2.5mld", ph_message: "Dettaglia il tuo scopo per unirti ai nostri ranghi..."
  }
};

function setLang(lang) {
  const t = translations[lang];
  document.documentElement.lang = lang;
  localStorage.setItem('lang', lang);
  document.title = t.title;

  const elements = {
    'nav-stats': t.nav_stats, 'nav-profiles': t.nav_profiles, 'nav-terminology': t.nav_terminology, 'nav-contact': t.nav_contact,
    'header-subtitle': t.header_subtitle, 'stats-title': t.stats_title, 'members-label': t.members_label, 'might-label': t.might_label, 'level-label': t.level_label,
    'profiles-title': t.profiles_title, 'member1-name': t.member1_name, 'member1-role': t.member1_role, 'member2-name': t.member2_name, 'member2-role': t.member2_role, 'member3-name': t.member3_name, 'member3-role': t.member3_role,
    'terminology-title': t.terminology_title, 'calc-title': t.calc_title, 'calc-label-total': t.calc_label_total, 'calc-label-split': t.calc_label_split,
    'calc-split-40': t.calc_split_40, 'calc-split-50': t.calc_split_50, 'calc-split-60': t.calc_split_60, 'calc-split-100': t.calc_split_100,
    'calc-label-comp': t.calc_label_comp, 'comp-inf': t.comp_inf, 'comp-rng': t.comp_rng, 'comp-cav': t.comp_cav, 'comp-442': t.comp_442, 'comp-424': t.comp_424, 'comp-244': t.comp_244,
    'btn-calculate': t.btn_calculate, 'calc-result-title': t.calc_result_title, 'res-inf-title': t.res_inf_title, 'res-rng-title': t.res_rng_title, 'res-cav-title': t.res_cav_title,
    'btn-copy': t.btn_copy,
    'contact-title': t.contact_title, 'label-name': t.label_name, 'label-iggid': t.label_iggid, 'label-might': t.label_might, 'label-role': t.label_role, 'label-message': t.label_message, 'form-disclaimer': t.form_disclaimer,
    'prevBtn': t.prev_btn, 'nextBtn': t.next_btn, 'submitBtn': t.submit_btn, 'footer-text1': t.footer1, 'copy-title': t.copy_title, 'copy-message': t.copy_message
  };

  for (let id in elements) {
    let el = document.getElementById(id);
    if (el) el.textContent = elements[id];
  }

  const placeholders = { 'name': t.ph_name, 'iggid': t.ph_iggid, 'might': t.ph_might, 'message': t.ph_message };
  for (let id in placeholders) {
    let el = document.getElementById(id);
    if (el) el.placeholder = placeholders[id];
  }
}

window.calculateTroops = function() {
  const total = parseInt(document.getElementById('total-troops').value) || 0;
  const t5Ratio = parseInt(document.getElementById('t5-split').value) / 100;
  const t4Ratio = 1 - t5Ratio;
  const comp = document.getElementById('comp-type').value;

  let infRatio = 0, rngRatio = 0, cavRatio = 0;

  switch(comp) {
    case 'inf-blast': infRatio = 1; break;
    case 'rng-blast': rngRatio = 1; break;
    case 'cav-blast': cavRatio = 1; break;
    case '442': infRatio = 0.4; rngRatio = 0.4; cavRatio = 0.2; break;
    case '424': infRatio = 0.4; rngRatio = 0.2; cavRatio = 0.4; break;
    case '244': infRatio = 0.2; rngRatio = 0.4; cavRatio = 0.4; break;
  }

  const setVal = (id, val) => {
    let element = document.getElementById(id);
    element.textContent = Math.round(val).toLocaleString();
    element.classList.remove('pulse-active');
    void element.offsetWidth;
    element.classList.add('pulse-active');
  };

  setVal('res-t5-inf', total * t5Ratio * infRatio);
  setVal('res-t4-inf', total * t4Ratio * infRatio);
  setVal('res-t5-rng', total * t5Ratio * rngRatio);
  setVal('res-t4-rng', total * t4Ratio * rngRatio);
  setVal('res-t5-cav', total * t5Ratio * cavRatio);
  setVal('res-t4-cav', total * t4Ratio * cavRatio);

  document.getElementById('calc-results').style.display = 'block';
};

window.copyResults = function() {
  const t = translations[localStorage.getItem('lang') || 'en'];
  const total = document.getElementById('total-troops').value;
  const split = document.getElementById('t5-split').options[document.getElementById('t5-split').selectedIndex].text;
  const comp = document.getElementById('comp-type').options[document.getElementById('comp-type').selectedIndex].text;

  const t5i = document.getElementById('res-t5-inf').textContent;
  const t4i = document.getElementById('res-t4-inf').textContent;
  const t5r = document.getElementById('res-t5-rng').textContent;
  const t4r = document.getElementById('res-t4-rng').textContent;
  const t5c = document.getElementById('res-t5-cav').textContent;
  const t4c = document.getElementById('res-t4-cav').textContent;

  const textToCopy = `OLD GENERATION DEPLOYMENT MATRIX\nTotal Capacity: ${total}\nRatio Integration: ${split}\nFormation Strategy: ${comp}\n\nINFANTRY => T5: ${t5i} | T4: ${t4i}\nRANGED => T5: ${t5r} | T4: ${t4r}\nCAVALRY => T5: ${t5c} | T4: ${t4c}`;

  navigator.clipboard.writeText(textToCopy).then(() => {
    const btn = document.getElementById('btn-copy');
    const originalText = btn.textContent;
    btn.textContent = t.msg_copied;
    btn.style.background = 'var(--gold)';
    btn.style.color = '#000';
    setTimeout(() => {
      btn.textContent = originalText;
      btn.style.background = '#222';
      btn.style.color = '#fff';
    }, 2000);
  });
};

document.addEventListener('DOMContentLoaded', () => {
  setLang(localStorage.getItem('lang') || 'en');

  let currentStep = 1;
  const steps = document.querySelectorAll('.form-step');
  const progressBar = document.getElementById('p-bar');

  const updateUI = () => {
    steps.forEach((s, i) => s.style.display = (i + 1 === currentStep) ? 'block' : 'none');
    document.getElementById('prevBtn').style.visibility = (currentStep === 1) ? 'hidden' : 'visible';
    document.getElementById('nextBtn').style.display = (currentStep === 3) ? 'none' : 'block';
    document.getElementById('submitBtn').style.display = (currentStep === 3) ? 'block' : 'none';
    progressBar.style.width = (currentStep / 3 * 100) + '%';
  };

  updateUI();

  document.getElementById('nextBtn').addEventListener('click', () => { if (currentStep < 3) { currentStep++; updateUI(); } });
  document.getElementById('prevBtn').addEventListener('click', () => { if (currentStep > 1) { currentStep--; updateUI(); } });

  ['contextmenu', 'selectstart', 'copy'].forEach(ev => document.addEventListener(ev, e => {
    e.preventDefault();
    let ov = document.getElementById('copy-protection');
    ov.style.opacity = '1'; ov.style.pointerEvents = 'all';
    setTimeout(() => { ov.style.opacity = '0'; ov.style.pointerEvents = 'none'; }, 2000);
  }));

  const scrollBtn = document.getElementById("scrollTopBtn");
  window.onscroll = function() {
    if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
      scrollBtn.style.display = "block";
    } else {
      scrollBtn.style.display = "none";
    }
  };
  scrollBtn.addEventListener("click", () => {
    window.scrollTo({top: 0, behavior: 'smooth'});
  });

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('is-visible');
      }
    });
  }, { threshold: 0.1 });

  document.querySelectorAll('section').forEach(sec => {
    sec.classList.add('fade-in-section');
    observer.observe(sec);
  });
});

if ('serviceWorker' in navigator) navigator.serviceWorker.register('/service-worker.js');

let ytPlayer;
window.onYouTubeIframeAPIReady = function() {
  ytPlayer = new YT.Player('ytplayer', {
    videoId: 'eD9sfQft3CQ',
    playerVars: {
      'autoplay': 1,
      'controls': 0,
      'mute': 1,
      'modestbranding': 1,
      'rel': 0,
      'disablekb': 1,
      'playsinline': 1,
      'loop': 1,
      'playlist': 'eD9sfQft3CQ'
    },
    events: {
      'onReady': function(event) {
        event.target.playVideo();
      }
    }
  });
};

window.toggleMute = function() {
  if(ytPlayer && ytPlayer.isMuted) {
    if(ytPlayer.isMuted()) {
      ytPlayer.unMute();
      document.getElementById('custom-mute-btn').textContent = 'SESİ KAPAT';
    } else {
      ytPlayer.mute();
      document.getElementById('custom-mute-btn').textContent = 'SESİ AÇ';
    }
  }
};
